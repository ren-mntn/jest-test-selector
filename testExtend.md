# Jest テストセレクター拡張機能 要件定義書
npm run compile && npm run package
## 1. 概要

モノレポ構造のプロジェクトで、特定の Jest テストケースを選択して実行するための VSCode 拡張機能。pnpm や npm、yarn などのパッケージマネージャに対応し、ディレクトリ構造を自動検出して適切な環境でテストを実行する。

## 2. コア機能要件

### 2.1 テスト検出機能

- 現在開いているファイルからテストケースを自動抽出
- `test('テスト名', ...)` 形式の Jest テストパターンを認識
- `describe` ブロック内の階層構造も正しく解析
- テストファイル以外では機能を無効化

### 2.2 テスト選択と実行

- クイックピック UI でテストケースをリスト表示
- 選択したテストケースのみを実行
- テスト実行前にパッケージマネージャとコマンドをカスタマイズ可能
- デバッグモードでの実行をサポート

### 2.3 モノレポ対応

- apps/package などの標準的なモノレポ構造を自動検出
- 適切なディレクトリに自動的に`cd`して実行
- ワークスペースのルートからの相対パスを正しく解決
- パッケージごとの固有設定をサポート

## 3. UI/UX 要件

### 3.1 コマンドとショートカット

- コマンドパレットからアクセス可能なコマンド
- カスタマイズ可能なキーボードショートカット（デフォルト: Cmd+Shift+T / Ctrl+Shift+T）
- ステータスバーへのアクションボタン追加（オプション）

### 3.2 テスト選択 UI

- テストケース名と所属する`describe`ブロックを表示
- 検索フィルタリングをサポート
- 最近実行したテストを履歴として保存・表示
- テストケース数が多い場合のグループ化対応

### 3.3 フィードバック

- テスト実行状態のプログレス表示
- 成功/失敗の通知
- テスト結果のサマリー表示
- エラー発生時の詳細情報アクセス

## 4. テクニカル要件

### 4.1 設定オプション

- パッケージマネージャ選択（pnpm/npm/yarn）
- テストコマンドカスタマイズ
- モノレポ構造パターン定義
- 環境変数の設定
- Jest CLI オプションの追加設定

### 4.2 プロジェクト構造検出

- package.json の検出と解析
- モノレポツール（lerna, nx, turbo など）の設定検出
- テストスクリプト定義の自動検出
- ワークスペースにあるアプリケーションの自動マッピング

### 4.3 統合機能

- VSCode のデバッグ機能との完全統合
- ターミナル出力との連携
- エディタのコードレンズ統合（オプション機能）
- Test Explorer との連携（オプション機能）

## 5. 拡張性とパフォーマンス

### 5.1 パフォーマンス要件

- 大規模テストファイルでの高速パース
- キャッシュ機能によるテスト検出の高速化
- 非同期処理による UI 応答性の維持

### 5.2 拡張性

- プラグイン形式でのテストフレームワーク拡張性
- カスタムテストランナーのサポート
- CI/CD 環境との連携機能

## 6. 制約と前提条件

### 6.1 前提条件

- VSCode 1.60.0 以上
- Node.js 14.0.0 以上
- Jest 環境が設定済みのプロジェクト

### 6.2 制約

- テストパターンは標準的な Jest 形式に準拠していること
- 特殊なテストセットアップは追加設定が必要な場合あり

## 7. 将来の拡張候補

- コードカバレッジ統合
- スナップショットテスト管理
- チーム間での設定共有
- リモート実行環境対応
